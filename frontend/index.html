<!DOCTYPE html>
<html>
<head>
<title>Guitar AI Studio</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #0f172a;
  color: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  overflow: hidden;
  height: 100vh;
  display: flex;
}

/* Main layout: camera on left, tabs on right */
.main-container {
  display: flex;
  width: 100vw;
  height: 100vh;
  flex-direction: column;
}

/* Navbar */
.navbar {
  width: 100%;
  height: 60px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  position: relative;
}

.navbar h1 {
  margin: 0;
  font-size: 28px;
  font-weight: 700;
  background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Content wrapper */
.content-wrapper {
  display: flex;
  flex: 1;
  width: 100%;
  height: calc(100vh - 60px);
  overflow: hidden;
}

/* Camera section - full screen left */
.camera-section {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
  position: relative;
  overflow: hidden;
}

.video-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.video-container img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Right sidebar with tabs */
.sidebar {
  width: 400px;
  background: #1e293b;
  border-left: 2px solid #334155;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Tab buttons */
.tab-header {
  display: flex;
  background: #0f172a;
  border-bottom: 2px solid #334155;
}

.tab-btn {
  flex: 1;
  padding: 15px 20px;
  background: transparent;
  border: none;
  color: #94a3b8;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border-bottom: 3px solid transparent;
  font-size: 14px;
}

.tab-btn:hover {
  background: #1e293b;
  color: white;
}

.tab-btn.active {
  color: #60a5fa;
  border-bottom-color: #60a5fa;
  background: #1e293b;
}

/* Tab content */
.tab-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: none;
}

.tab-content.active {
  display: block;
}

/* Scrollbar styling */
.tab-content::-webkit-scrollbar {
  width: 8px;
}

.tab-content::-webkit-scrollbar-track {
  background: #1e293b;
}

.tab-content::-webkit-scrollbar-thumb {
  background: #475569;
  border-radius: 4px;
}

.tab-content::-webkit-scrollbar-thumb:hover {
  background: #64748b;
}

/* Card styling */
.card {
  background: #020617;
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.card h3 {
  margin-bottom: 15px;
  color: #e2e8f0;
  font-size: 18px;
}

/* Buttons */
button {
  padding: 12px 24px;
  background: #22c55e;
  border: none;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 14px;
  width: 100%;
  margin-bottom: 10px;
}

button:hover {
  background: #16a34a;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(34, 197, 94, 0.3);
}

button:active {
  transform: translateY(0);
}

button.detect-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 15px;
  font-size: 16px;
}

button.detect-btn:hover {
  background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

/* Detection results */
.result-box {
  background: rgba(102, 126, 234, 0.1);
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
  min-height: 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.result-label {
  font-size: 14px;
  color: #94a3b8;
  margin-bottom: 5px;
}

.result-value {
  font-size: 24px;
  font-weight: 700;
  color: #60a5fa;
}

.result-confidence {
  font-size: 14px;
  color: #94a3b8;
  margin-top: 5px;
}

/* Chord display */
.chord-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin-top: 20px;
}

.chord-name-box {
  background: rgba(102, 126, 234, 0.2);
  padding: 15px 30px;
  border-radius: 12px;
  border: 2px solid #667eea;
}

.chord-name {
  font-size: 32px;
  font-weight: 700;
  color: #60a5fa;
  text-align: center;
}

.chord-diagrams {
  display: flex;
  gap: 30px;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}

.chord-diagram-container {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.staff-container {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Style transfer */
.style-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 15px;
}

.style-btn {
  padding: 12px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: 2px solid transparent;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 12px;
  text-transform: capitalize;
}

.style-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
  border-color: rgba(255, 255, 255, 0.3);
}

.style-btn.active {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  border-color: #f5576c;
  box-shadow: 0 0 20px rgba(245, 87, 108, 0.5);
}

.current-style {
  margin-top: 10px;
  padding: 10px;
  background: rgba(102, 126, 234, 0.2);
  border-radius: 8px;
  font-size: 14px;
  text-align: center;
}

/* Loading state */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Guitar type display */
.guitar-type-display {
  text-align: center;
  padding: 20px;
}

.guitar-icon {
  font-size: 48px;
  margin-bottom: 15px;
}

.guitar-type-name {
  font-size: 28px;
  font-weight: 700;
  color: #60a5fa;
  margin-bottom: 10px;
  text-transform: capitalize;
}

.guitar-type-name::before {
  content: "ðŸŽ¸ ";
}
</style>
</head>

<body>
  <div class="main-container">
    <!-- Navbar -->
    <nav class="navbar">
      <h1>ðŸŽ¸ Guitar AI Studio</h1>
    </nav>

    <!-- Content wrapper -->
    <div class="content-wrapper">
      <!-- Camera section - full screen left -->
      <div class="camera-section">
        <div class="video-container">
          <img src="/video" id="videoFeed" alt="Camera Feed"/>
        </div>
      </div>

    <!-- Right sidebar with tabs -->
    <div class="sidebar">
      <!-- Tab buttons -->
      <div class="tab-header">
        <button class="tab-btn active" onclick="switchTab('guitar')">Guitar</button>
        <button class="tab-btn" onclick="switchTab('chord')">Chord</button>
        <button class="tab-btn" onclick="switchTab('style')">Style</button>
        <button class="tab-btn" onclick="switchTab('generation')">Generation</button>
      </div>

      <!-- Guitar Tab -->
      <div id="guitar-tab" class="tab-content active">
        <div class="card">
          <h3>ðŸŽ¸ Guitar Type Detection</h3>
          <button class="detect-btn" onclick="captureAndDetectGuitar()">Capture & Detect Guitar</button>
          <div id="guitar-result" class="result-box" style="display: none;">
            <div class="guitar-type-display">
              <div class="guitar-icon">ðŸŽ¸</div>
              <div class="guitar-type-name" id="guitar-type-name"></div>
              <div class="guitar-brand" id="guitar-brand" style="font-size: 18px; color: #94a3b8; margin-top: 10px;"></div>
              <div class="result-confidence" id="guitar-confidence"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chord Tab -->
      <div id="chord-tab" class="tab-content">
        <div class="card">
          <h3>ðŸŽµ Chord Detection</h3>
          <button class="detect-btn" onclick="getChord()">Detect Chord</button>
          <div id="chord-result" class="result-box" style="display: none;">
            <div class="result-label">Detected Chord</div>
            <div class="result-value" id="chord-name"></div>
            <div class="result-confidence" id="chord-confidence"></div>
          </div>
        </div>
        <div id="chord-display" class="chord-display" style="display: none;">
          <div class="chord-name-box">
            <div class="chord-name" id="chord-display-name"></div>
          </div>
          <div class="chord-diagrams">
            <div class="chord-diagram-container">
              <svg id="chord-diagram" width="200" height="250"></svg>
            </div>
            <div class="staff-container">
              <svg id="staff-notation" width="300" height="200"></svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Style Tab -->
      <div id="style-tab" class="tab-content">
        <div class="card">
          <h3>ðŸŽ¨ Virtual Custom Shop</h3>
          <div class="current-style" id="currentStyle">Current Style: Original</div>
          <div class="style-grid" id="styleGrid"></div>
        </div>
      </div>

      <!-- Generation Tab -->
      <div id="generation-tab" class="tab-content">
        <div class="card">
          <h3>ðŸŽ¨ AI Image Generation</h3>
          <div style="margin-bottom: 15px;">
            <label for="generation-query" style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">
              Enter your prompt:
            </label>
            <input 
              type="text" 
              id="generation-query" 
              placeholder="e.g., a beautiful sunset over mountains"
              style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; font-size: 14px; margin-bottom: 10px;"
            />
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
              <input 
                type="checkbox" 
                id="use-random-prompt" 
                checked
                style="width: 18px; height: 18px; cursor: pointer;"
              />
              <label for="use-random-prompt" style="color: #94a3b8; font-size: 13px; cursor: pointer;">
                Use random prompt enhancement
              </label>
            </div>
          </div>
          <button class="detect-btn" onclick="generateImage()" id="generate-btn">
            Generate Image
          </button>
          <div id="generation-result" class="result-box" style="display: none; margin-top: 15px;">
            <div id="generation-status" style="text-align: center; color: #94a3b8;"></div>
            <div id="generated-image-container" style="margin-top: 15px; display: none;">
              <img id="generated-image" style="width: 100%; border-radius: 8px; max-height: 400px; object-fit: contain;" />
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <script>
    let currentStyle = 'none';
    let styles = {};
    let currentTab = 'guitar';

    // Tab switching
    function switchTab(tabName) {
      currentTab = tabName;
      
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach((btn, index) => {
        btn.classList.remove('active');
        const tabNames = ['guitar', 'chord', 'style', 'generation'];
        if (tabNames[index] === tabName) {
          btn.classList.add('active');
        }
      });
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName + '-tab').classList.add('active');
    }

    // Load available styles
    async function loadStyles() {
      try {
        const response = await fetch('/styles');
        const data = await response.json();
        styles = data.styles;
        currentStyle = data.current || 'none';
        renderStyleButtons();
        updateCurrentStyleDisplay();
      } catch (error) {
        console.error('Error loading styles:', error);
      }
    }

    // Render style buttons
    function renderStyleButtons() {
      const grid = document.getElementById('styleGrid');
      grid.innerHTML = '';
      
      for (const [key, displayName] of Object.entries(styles)) {
        const btn = document.createElement('button');
        btn.className = 'style-btn' + (key === currentStyle ? ' active' : '');
        btn.textContent = displayName;
        btn.onclick = () => setStyle(key);
        grid.appendChild(btn);
      }
    }

    // Set style
    async function setStyle(styleName) {
      try {
        const response = await fetch(`/style/${styleName}`, { method: 'POST' });
        const data = await response.json();
        
        if (data.success) {
          currentStyle = styleName;
          renderStyleButtons();
          updateCurrentStyleDisplay();
          
          // Force video refresh
          const videoFeed = document.getElementById('videoFeed');
          const src = videoFeed.src;
          videoFeed.src = '';
          setTimeout(() => {
            videoFeed.src = src + '?t=' + Date.now();
          }, 100);
        } else {
          console.error('Failed to set style:', data.error);
        }
      } catch (error) {
        console.error('Error setting style:', error);
      }
    }

    // Update current style display
    function updateCurrentStyleDisplay() {
      const display = document.getElementById('currentStyle');
      const styleName = styles[currentStyle] || 'Original';
      display.textContent = `Current Style: ${styleName}`;
    }

    // Capture current frame and detect guitar
    async function captureAndDetectGuitar() {
      const resultBox = document.getElementById('guitar-result');
      const guitarName = document.getElementById('guitar-type-name');
      const guitarBrand = document.getElementById('guitar-brand');
      const guitarConf = document.getElementById('guitar-confidence');
      
      resultBox.style.display = 'flex';
      guitarName.textContent = 'Capturing...';
      guitarBrand.textContent = '';
      guitarConf.textContent = '';
      
      try {
        // The video feed is an img tag with a streaming source
        // We'll use the GET endpoint which captures the latest frame from the camera
        const r = await fetch('/guitar');
        
        // Check if response is ok
        if (!r.ok) {
          const errorText = await r.text();
          throw new Error(`Server error: ${r.status} - ${errorText}`);
        }
        
        const d = await r.json();
        
        // Display results
        if (d.error) {
          guitarName.textContent = d.class_name || 'Error';
          guitarBrand.textContent = '';
          guitarConf.textContent = d.error;
        } else {
          guitarName.textContent = d.type || d.class_name || `Class ${d.class}`;
          guitarBrand.textContent = `Brand: ${d.brand || 'Unknown'}`;
          guitarConf.textContent = `Confidence: ${(d.confidence * 100).toFixed(2)}%`;
        }
      } catch (error) {
        guitarName.textContent = 'Error';
        guitarBrand.textContent = '';
        guitarConf.textContent = error.message || 'Failed to detect guitar';
        console.error('Guitar detection error:', error);
      }
    }

    // Chord detection
    async function getChord() {
      const resultBox = document.getElementById('chord-result');
      const chordName = document.getElementById('chord-name');
      const chordConf = document.getElementById('chord-confidence');
      const chordDisplay = document.getElementById('chord-display');
      
      resultBox.style.display = 'flex';
      chordName.textContent = 'Listening...';
      chordConf.textContent = '';
      chordDisplay.style.display = 'none';
      
      try {
        const r = await fetch('/chord');
        const d = await r.json();
        
        chordName.textContent = d.class;
        chordConf.textContent = `Confidence: ${(d.confidence * 100).toFixed(2)}%`;
        
        // Show chord diagram
        await displayChord(d.class);
        chordDisplay.style.display = 'flex';
      } catch (error) {
        chordName.textContent = 'Error';
        chordConf.textContent = error.message;
        console.error('Chord detection error:', error);
      }
    }

    // Display chord diagram and staff
    async function displayChord(chordName) {
      try {
        // Fetch chord diagram data
        const response = await fetch(`/chord/diagram/${encodeURIComponent(chordName)}`);
        const chordData = await response.json();
        
        // Update chord name display
        document.getElementById('chord-display-name').textContent = chordData.name;
        
        // Draw chord diagram
        drawChordDiagram(chordData.fingering);
        
        // Draw staff notation
        drawStaffNotation(chordData.notes);
      } catch (error) {
        console.error('Error loading chord diagram:', error);
        // Draw default chord diagram
        drawChordDiagram(null);
        drawStaffNotation(['C', 'E', 'G']);
      }
    }

    // Draw chord diagram
    function drawChordDiagram(fingering) {
      const svg = document.getElementById('chord-diagram');
      svg.innerHTML = '';
      
      const width = 200;
      const height = 250;
      const stringSpacing = 30;
      const fretSpacing = 40;
      const startX = 40;
      const startY = 30;
      const numStrings = 6;
      const numFrets = 5;
      
      // Draw strings (vertical lines)
      for (let i = 0; i < numStrings; i++) {
        const x = startX + i * stringSpacing;
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', x);
        line.setAttribute('y1', startY);
        line.setAttribute('x2', x);
        line.setAttribute('y2', startY + numFrets * fretSpacing);
        line.setAttribute('stroke', '#000');
        line.setAttribute('stroke-width', '2');
        svg.appendChild(line);
      }
      
      // Draw frets (horizontal lines)
      for (let i = 0; i <= numFrets; i++) {
        const y = startY + i * fretSpacing;
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', startX);
        line.setAttribute('y1', y);
        line.setAttribute('x2', startX + (numStrings - 1) * stringSpacing);
        line.setAttribute('y2', y);
        line.setAttribute('stroke', '#000');
        line.setAttribute('stroke-width', i === 0 ? '4' : '2');
        svg.appendChild(line);
      }
      
      // Draw finger positions
      if (fingering && fingering.frets) {
        for (let i = 0; i < numStrings; i++) {
          const fret = fingering.frets[i];
          const x = startX + i * stringSpacing;
          
          if (fret === 0) {
            // Open string - draw 'O' above nut
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', x);
            circle.setAttribute('cy', startY - 15);
            circle.setAttribute('r', '8');
            circle.setAttribute('fill', 'none');
            circle.setAttribute('stroke', '#000');
            circle.setAttribute('stroke-width', '2');
            svg.appendChild(circle);
          } else if (fret > 0) {
            // Fingered note - draw dot
            const y = startY + (fret - 0.5) * fretSpacing;
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', x);
            circle.setAttribute('cy', y);
            circle.setAttribute('r', '10');
            circle.setAttribute('fill', '#000');
            svg.appendChild(circle);
          } else {
            // Muted string - draw 'X' above nut
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', startY - 10);
            text.setAttribute('font-size', '16');
            text.setAttribute('font-weight', 'bold');
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', '#000');
            text.textContent = 'X';
            svg.appendChild(text);
          }
        }
      }
    }

    // Draw staff notation
    function drawStaffNotation(notes) {
      const svg = document.getElementById('staff-notation');
      svg.innerHTML = '';
      
      const width = 300;
      const height = 200;
      const staffTop = 40;
      const staffHeight = 80;
      const lineSpacing = staffHeight / 4;
      const noteRadius = 8;
      
      // Draw treble clef (simplified)
      const clef = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      clef.setAttribute('x', '20');
      clef.setAttribute('y', staffTop + staffHeight / 2 + 5);
      clef.setAttribute('font-size', '40');
      clef.setAttribute('font-family', 'serif');
      clef.setAttribute('fill', '#000');
      clef.textContent = 'â™©';
      svg.appendChild(clef);
      
      // Draw staff lines
      for (let i = 0; i < 5; i++) {
        const y = staffTop + i * lineSpacing;
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', '60');
        line.setAttribute('y1', y);
        line.setAttribute('x2', width - 20);
        line.setAttribute('y2', y);
        line.setAttribute('stroke', '#000');
        line.setAttribute('stroke-width', '2');
        svg.appendChild(line);
      }
      
      // Note positions on staff (simplified mapping)
      const notePositions = {
        'C': staffTop + 4 * lineSpacing + 10, // Below staff
        'D': staffTop + 4 * lineSpacing,
        'E': staffTop + 3 * lineSpacing + 5,
        'F': staffTop + 3 * lineSpacing,
        'G': staffTop + 2 * lineSpacing + 5,
        'A': staffTop + 2 * lineSpacing,
        'B': staffTop + 1 * lineSpacing + 5,
        'C#': staffTop + 3 * lineSpacing + 5,
        'D#': staffTop + 2 * lineSpacing + 5,
        'F#': staffTop + 2 * lineSpacing + 5,
        'G#': staffTop + 1 * lineSpacing + 5,
      };
      
      // Draw notes
      const startX = 100;
      const noteSpacing = 40;
      notes.forEach((note, index) => {
        const baseNote = note.replace('#', '');
        let y = notePositions[note] || notePositions[baseNote] || staffTop + 2 * lineSpacing;
        
        // Draw note head
        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', startX + index * noteSpacing);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', noteRadius);
        circle.setAttribute('fill', '#000');
        svg.appendChild(circle);
        
        // Draw ledger lines if needed
        if (y > staffTop + 4 * lineSpacing || y < staffTop) {
          const ledgerLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          ledgerLine.setAttribute('x1', startX + index * noteSpacing - noteRadius - 2);
          ledgerLine.setAttribute('y1', y);
          ledgerLine.setAttribute('x2', startX + index * noteSpacing + noteRadius + 2);
          ledgerLine.setAttribute('y2', y);
          ledgerLine.setAttribute('stroke', '#000');
          ledgerLine.setAttribute('stroke-width', '2');
          svg.insertBefore(ledgerLine, circle);
        }
      });
    }

    // Image generation
    async function generateImage() {
      const queryInput = document.getElementById('generation-query');
      const useRandom = document.getElementById('use-random-prompt').checked;
      const resultBox = document.getElementById('generation-result');
      const statusDiv = document.getElementById('generation-status');
      const imageContainer = document.getElementById('generated-image-container');
      const generatedImage = document.getElementById('generated-image');
      const generateBtn = document.getElementById('generate-btn');
      
      const query = queryInput.value.trim();
      
      if (!query) {
        alert('Please enter a prompt for image generation');
        return;
      }
      
      // Show loading state
      resultBox.style.display = 'flex';
      imageContainer.style.display = 'none';
      statusDiv.textContent = 'Generating image... This may take a minute.';
      statusDiv.style.color = '#60a5fa';
      generateBtn.disabled = true;
      generateBtn.textContent = 'Generating...';
      
      try {
        const response = await fetch('/generate/image', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            query: query,
            use_random_prompt: useRandom,
            num_inference_steps: 50,
            guidance_scale: 7.5
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.detail || 'Failed to generate image');
        }
        
        const data = await response.json();
        
        if (data.success) {
          // Display the generated image
          generatedImage.src = data.image_url;
          imageContainer.style.display = 'block';
          statusDiv.textContent = 'Image generated successfully!';
          statusDiv.style.color = '#22c55e';
        } else {
          throw new Error('Generation failed');
        }
      } catch (error) {
        statusDiv.textContent = `Error: ${error.message}`;
        statusDiv.style.color = '#ef4444';
        console.error('Image generation error:', error);
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = 'Generate Image';
      }
    }

    // Initialize on load
    window.addEventListener('load', () => {
      loadStyles();
      
      // Refresh current style every 5 seconds
      setInterval(async () => {
        try {
          const response = await fetch('/style/current');
          const data = await response.json();
          if (data.style !== currentStyle) {
            currentStyle = data.style;
            renderStyleButtons();
            updateCurrentStyleDisplay();
          }
        } catch (error) {
          console.error('Error checking current style:', error);
        }
      }, 5000);
    });
  </script>
</body>
</html>
